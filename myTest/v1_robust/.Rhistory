s
HuberM <- function(X, k){   # the Huber M estimate for sample X
sum_psi0 <- function(Z, k){
ss <- 0
for(z in Z)
if (abs(z) < k)   ss <- ss + z
else if (z <= -k) ss <- ss - k
else if (z >= k)  ss <- ss + k
return(ss)
}
return(uniroot(function(t) sum_psi0(X-t, k),
lower=min(X), upper=max(X), tol=1e-5))
}
sim <- function(n, k = 1, N = 1000){
count <- 0              # amount of CIs that cover the true mean 0
z0 <- qnorm(1-0.025)
for(i in 1:N){
X <- rnorm(N)
Tn <- HuberM(X, k)
# the asymptotic variance of Tn
s <- ((-2/sqrt(2*pi))*k*exp(-k^2/2) + 1 + 2*(k^2-1)*pnorm(-k)) /
(1-2*pnorm(-k))^2
if ((Tn - z0*s < 0) & (Tn + z0*s > 0)) count <- count + 1
}
return(count/N)
}
sim(n = 20)
n=20
k
N
count <- 0              # amount of CIs that cover the true mean 0
z0 <- qnorm(1-0.025)
z0
for(i in 1:N){
X <- rnorm(n)
Tn <- HuberM(X, k)
# the asymptotic variance of Tn
s <- ((-2/sqrt(2*pi))*k*exp(-k^2/2) + 1 + 2*(k^2-1)*pnorm(-k)) /
(1-2*pnorm(-k))^2
if ((Tn - z0*s < 0) & (Tn + z0*s > 0)) count <- count + 1
}
i
X <- rnorm(n)
X
Tn <- HuberM(X, k)
Tn
Tn <- HuberM(X, k)$root
Tn
s <- ((-2/sqrt(2*pi))*k*exp(-k^2/2) + 1 + 2*(k^2-1)*pnorm(-k)) /
(1-2*pnorm(-k))^2
if ((Tn - z0*s < 0) & (Tn + z0*s > 0)) count <- count + 1
y <- c(11.54,
11.00,
11.42,
11.44,
11.28)
mean(y)
sum((y-mean(y))^2*13)
s <- c(0.27,
0.47,
0.31,
0.42,
0.31)
n <- 13
ssw <- sum(s^2*(n-1))
ssw <- sum(s^2*(n-1)); ssw
ss1 <- sum((y-mean(y))^2*n); ss1
sse <- sum(s^2*(n-1)); sse
ms1 <- ss1 / 4; ms1
mse <- sse / 60; mse
ss1 + sse
pf(F.t, 4, 60)
F.t <- ms1/mse; F.t
pf(F.t, 4, 60)
1 - pf(F.t, 4, 60)
sqrt(2.8)
2.5^2
2.5^2/0.4
16*0.4
sqrt(16*0.4)
X <- matrix(c(106, 101, 120, 86, 132, 97,
51, 98, 85, 50, 111, 72,
103, 84, 100, 83, 110, 91,
50, 66, 61, 72, 85, 60), nrow=4, byrow = T)
X
x.m <- rowMeans(X)
x.m
x.sd <- apply(X, 1, sd)
x.sd
ss1 <- sum((x-x.m)^2*n); ss1
X <- matrix(c(106, 101, 120, 86, 132, 97,
51, 98, 85, 50, 111, 72,
103, 84, 100, 83, 110, 91,
50, 66, 61, 72, 85, 60), nrow=4, byrow = T)
x.m <- rowMeans(X)
x.sd <- apply(X, 1, sd)
n <- 6
ss1 <- sum((x.m-mean(x.m))^2*n); ss1
x.m
x.sd
sse <- sum(x.sd^2*(n-1)); sse
ss1 + sse
ss1 <- sum((x.m-mean(x.m))^2*n); ss1
sse <- sum(x.sd^2*(n-1)); sse
ss1 + sse
v1 <- 4-1; v2 <- 4*(n-1)
v1
v2
v1 <- 4-1; v2 <- 4*(n-1); v1; v2
ms1 <- ss1 / v1; ms1
mse <- sse / v2; mse
F.t <- ms1/mse; F.t
1 - pf(F.t, v1, v2)
c1 <- c(1,1,-1,-1)
crossprod(c1, x.m)
crossprod(c1, x.m)^2*(3/2)
x.m <- rowMeans(X); x.m
c1 <- c(1,1,-1,-1); c2 <- c(1,-1,1,-1); c3 <- c(1,-1,-1,1)
crossprod(c2, x.m)^2*(3/2)
crossprod(c3, x.m)^2*(3/2)
crossprod(c3, x.m)^2*(3/2)
crossprod(c3, x.m)
x.m
crossprod(c2, x.m)^2*(3/2)
crossprod(c3, x.m)^2*(3/2)
ssc2 <- crossprod(c2, x.m)^2*(3/2); ssc2
ssc3 <- crossprod(c3, x.m)^2*(3/2); ssc3
ssc1 <- crossprod(c1, x.m)^2*(3/2); ssc1
f1 <- ssc1/mse
f1 <- ssc1/mse; f1
1 - pf(F.t, 1, v2)
f1 <- ssc1/mse; f1; 1 - pf(f1, 1, v2)
f2 <- ssc2/mse; f2; 1 - pf(f2, 1, v2)
f3 <- ssc3/mse; f3; 1 - pf(f3, 1, v2)
X <- matrix(c(1, 22.8, 1, 22.5, 1, 21.5, 1, 21.6, 1, 22.1,
2, 21.2, 2, 19.5, 2, 20.3, 2, 20.6, 2, 19.8,
3, 20.8, 3, 21  , 3, 22.2, 3, 21.6, 3, 20.4,
4, 23.7, 4, 23.3, 4, 22.4, 4, 22.6, 4, 22.9), ncol=2, byrow=T)
X
dt <- data.frame(temp=X[,1], den=x[,2])
dt
dt <- data.frame(temp=X[,1], den=X[,2])
dt
dt <- data.frame(temp=as.factor(X[,1]), den=X[,2])
dt
fit <- lm(den~temp, dt)
fit
anova(fit)
poly(X)
contr.poly(4)
mean(dt$den)
N <- 10000
p <- 5
X <- rep(1/p, p)
R <- 1
theta <- NULL
sim <- rnorm(p)
sim
sim+X
sim+X
X
sim <- rnorm(p) + X
crossprod(sim)
N <- 1000
p <- 5
X <- rep(1/p, p)
R2 <- 1
theta <- NULL
for (i in 1:N){
sim <- rnorm(p) + X
while (crossprod(sim) > R2){
sim <- rnorm(p) + X
}
theta <- cbind(theta, sim)
}
theta
dim(theta)
rowMeans(theta)
X <- c(1/2, 0,0,0,0)
dim(theta)
N <- 1000
p <- 5
X <- c(1/2, 0,0,0,0)
R2 <- 1
theta <- NULL
for (i in 1:N){
sim <- rnorm(p) + X
while (crossprod(sim) > R2){
sim <- rnorm(p) + X
}
theta <- cbind(theta, sim)
}
dim(theta)
rowMeans(theta)
crossprod(rowMeans(theta)/crossprod(X)
crossprod(rowMeans(theta))/crossprod(X)
sim <- rnorm + X[1]
sim <- rnorm() + X[1]
sim <- rnorm(1) + X[1]
sim
for (i in 1:N){
sim <- rnorm(1) + X[1]
while (crossprod(sim) > R){
sim <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim)
}
mean(theta2)/X[1]
N <- 1000
p <- 5
X <- c(1/2, 0,0,0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim <- rnorm(p) + X
while (crossprod(sim) > R^2){
sim <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim)
}
dim(theta1)
crossprod(rowMeans(theta1))/crossprod(X)
for (i in 1:N){
sim <- rnorm(1) + X[1]
while (crossprod(sim) > R){
sim <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim)
}
mean(theta2)/X[1]
crossprod(rowMeans(theta1))/crossprod(X)
N <- 10000
N <- 10000
p <- 5
X <- c(1/2, 0,0,0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim <- rnorm(p) + X
while (crossprod(sim) > R^2){
sim <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim)
}
dim(theta1)
crossprod(rowMeans(theta1))/crossprod(X)
for (i in 1:N){
sim <- rnorm(1) + X[1]
while (crossprod(sim) > R){
sim <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim)
}
mean(theta2)/X[1]
N <- 10000
p <- 5
X <- c(1/2, 0,0,0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
crossprod(rowMeans(theta1))/crossprod(X)
mean(theta2)/X[1]
sqrt(crossprod(rowMeans(theta1))/crossprod(X))
mean(theta2)/X[1]
N <- 10000
p <- 5
X <- c(1/2, 0,0,0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))
mean(theta2)/X[1]
N <- 10000
p <- 5
X <- c(1/2, 0,0,0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))
mean(theta2)/X[1]
N <- 10000
p <- 5
X <- c(1/2, 0,0,0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))/(mean(theta2)/X[1])
N <- 10000
p <- 5
X <- c(1/2, 0,0,0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))/(mean(theta2)/X[1])
N <- 10000
p <- 5
X <- c(1/2, 0,0,0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))/(mean(theta2)/X[1])
N <- 10000
p <- 5
X <- c(1/2, 0,0,0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))/(mean(theta2)/X[1])
N <- 10000
p <- 3
X <- c(1/2, 0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))/(mean(theta2)/X[1])
N <- 10000
p <- 3
X <- c(1/2, 0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))/(mean(theta2)/X[1])
N <- 10000
p <- 3
X <- c(1/2, 0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))/(mean(theta2)/X[1])
N <- 10000
p <- 3
X <- c(1/2, 0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))/(mean(theta2)/X[1])
N <- 10000
p <- 3
X <- c(1/2, 0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))/(mean(theta2)/X[1])
N <- 10000
p <- 3
X <- c(1/2, 0,0)
R <- 1
theta1 <- NULL
theta2 <- NULL
for (i in 1:N){
sim1 <- rnorm(p) + X
while (crossprod(sim1) > R^2){
sim1 <- rnorm(p) + X
}
theta1 <- cbind(theta1, sim1)
sim2 <- rnorm(1) + X[1]
while (crossprod(sim2) > R){
sim2 <- rnorm(1) + X[1]
}
theta2 <- c(theta2, sim2)
}
sqrt(crossprod(rowMeans(theta1))/crossprod(X))/(mean(theta2)/X[1])
setwd("~/GoogleDrive/Purdue/Research/Vinayak_Rao/17Spr_Genetic/Softwares/test/v1_robust")
load("../v1_rb_result_2.rda")
res[1,]
res[1:20,]
